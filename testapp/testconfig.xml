<debut>

    <source type="mysql">
        <ip>127.0.0.1</ip>
        <port>3306</port>
        <name>TestPFE</name>
        <user>root</user>
        <password>root</password>
    </source>

    <cible type="hbase">
        <ip>127.0.0.1</ip>
        <port>2181</port>
    </cible>

    <SCible>
        <name>EMPLOYEES</name>
        <cols CF="FAMILY_EMPLOYEE;ADDRESS_EMPLOYEE" />
    </SCible>

    <StructuresCibles>
        <StructureCible id="0" name="EMPLOYEES" CF="FAMILY_EMPLOYEE;ADDRESS_EMPLOYEE"/>

        <StructureCible id="1" name="STUDENTS" CF="FAMILY_STUDENT;NOTE_STUDENT"/>

        <StructureCible id="3" name="DEPARTEMENT" CF="DEPARTEMENT_DETAILS" />

    </StructuresCibles>

    <ClientClass>
        <Function NameClass="com.vermeg.testapp.services.TestService" NameFunction="getAge" InputClass="java.lang.String" />
        <Function NameClass="com.vermeg.testapp.services.TestService" NameFunction="getcurrency" InputClass="java.lang.String" />
        <Function NameClass="com.vermeg.testapp.services.TestService" NameFunction="formatNumber" InputClass="java.lang.Double" />
        <Function NameClass="com.vermeg.testapp.services.TestService" NameFunction="FormatDate" InputClass="java.lang.String" />

    </ClientClass>

    <VariablesGlobales>
        <vg name="tauxr" value="#getcurrency('http://demo1525832.mockable.io/currency')" />
    </VariablesGlobales>


    <TablesSources>
        <Table name="etudiant"/>
        <Table name="user" />
        <Table name="address"/>
        <Table  name="departement"/>
        <Table name="addressdetails" />
    </TablesSources>



    <aggregations>



        <aggregation type="racine" id="0" idrow="T(java.lang.String).valueOf(#numEtudiant)"  colonnessources="etudiant.numEtudiant,etudiant.nom,etudiant.prenom,etudiant.email,etudiant.birthDate"
                     tablesource="etudiant"  targettable="STUDENTS"  >
            <RichKeyMapping father="0"  columnqualifier="FAMILY_STUDENT:Nom"  mappingformula="#nom+' '+#prenom"/>
            <RichKeyMapping  father="0" columnqualifier="FAMILY_STUDENT:email" strictpattern="true" pattern="#email matches '^[A-Z0-9._%+-]+@(?:[A-Z0-9-]+\.)+[A-Z]{2,}$' " mappingformula="#email"/>
            <RichKeyMapping father="0" columnqualifier="FAMILY_STUDENT:age"  mappingformula="#getAge(#birthDate)"/>
        </aggregation>






        <aggregation type="racine" id="1" idrow="T(java.lang.String).valueOf(#USERId)"  colonnessources="user.userId AS USERId,user.firstName,user.lastName,user.birthDate,user.taille,user.salaire"
                     tablesource="user"  targettable="EMPLOYEES"  >
            <RichKeyMapping   father="1" mappingformula="T(java.lang.String).valueOf(#salaire *#tauxr)"  condition="#salaire gt 300 ? true : false" columnqualifier="FAMILY_EMPLOYEE:Salaire"/>

            <RichKeyMapping  father="1" formatters="#taille=#formatNumber(#taille)" mappingformula="T(java.lang.String).valueOf(#taille)" condition="#taille gt 2 ? true : false"   columnqualifier="FAMILY_EMPLOYEE:Taille"/>
            <RichKeyMapping  father="1" mappingformula="#getAge(#birthDate)"   columnqualifier="FAMILY_EMPLOYEE:Age"/>
            <RichKeyMapping  father="1" formatters="#birthDate=#FormatDate(#birthDate)" mappingformula="#birthDate" pattern="#birthDate matches '^(0[1-9]|1[012])[- /.](0[1-9]|[12][0-9]|3[01])[- /.](19|20)\d\d$'"
                            columnqualifier="FAMILY_EMPLOYEE:BirthDate"/>
            <RichKeyMapping  father="1" mappingformula="#firstName+' '+#lastName"  columnqualifier="FAMILY_EMPLOYEE:FullName"/>
            <RichKeyMapping  father="1" mappingformula="T(java.lang.String).valueOf(#USERId)" columnqualifier="FAMILY_EMPLOYEE:Iduser"/>


            <aggregation  id="2" father="1"  idrow="T(java.lang.String).valueOf(#USERId)"  colonnessources="address.addressId, address.pays,address.ville,address.rue,address.codePostal,address.userByUserId"
                         tableintermediaire="null" keyjoinint="null" keyjoin="'userByUserId = ' + T(java.lang.String).valueOf(#USERId)"  tablesource="address"  targettable="EMPLOYEES">

                <RichKeyMapping father="2" type="Document"  mappingformula="*" columnqualifier="ADDRESS_EMPLOYEE:address"/>

                <aggregation id="3" father="2" idrow="T(java.lang.String).valueOf(#USERId)" colonnessources="id_detail, nom_detail, address_id"
                      keyjoin="'address_id =' + T(java.lang.String).valueOf(#addressId)" tablesource="addressdetails" targettable="EMPLOYEES">
                    <RichKeyMapping father="3" type="Document" mappingformula="*" columnqualifier="ADDRESS_EMPLOYEE:details"/>

                </aggregation>

            </aggregation>

        </aggregation>


        <aggregation type="racine" id="4" idrow="T(java.lang.String).valueOf(#idDept)"  colonnessources="idDept,nomDept"
                         tablesource="departement"  targettable="DEPARTEMENT"  >

                <RichKeyMapping  father="4" mappingformula="T(java.lang.String).valueOf(#idDept)"   columnqualifier="DEPARTEMENT_DETAILS:iddepartement"/>
                <RichKeyMapping  father="4" mappingformula="#nomDept"   columnqualifier="DEPARTEMENT_DETAILS:nomdepartement"/>

            </aggregation>




    </aggregations>

</debut>
